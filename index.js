const {Builder, By, Key, until} = require('selenium-webdriver');
const sleep = require('sleep');
const ping = require('ping');
const proxy = require('selenium-webdriver/proxy');
const chrome = require('selenium-webdriver/chrome');
const firefox = require('selenium-webdriver/firefox');
// d49f02b1c84c76791c624e650ee05759
const chalk = require('chalk');
const log = console.log;
const axios = require('axios');


const screen = {
  width: 640,
  height: 480
};

const params = {
  // access_key: 'd49f02b1c84c76791c624e650ee05759',
  // url: 'http://scrapestack.com',
  // proxy_location: 'id'
}

// axios.get('http://api.scrapestack.com/scrape', {params})
//   .then(response => {
//     const websiteContent = response.data;
//     console.log(websiteContent);
//   }).catch(error => {
//     console.log(error);
//   });

const proxyServer = [


  // '139.255.58.94:8080',
  // '36.74.44.53:80',
  // '36.67.121.91:8080',
  // '202.138.239.242:8080',
  // '103.123.229.106:8080',
  // '183.81.157.220:8080',
  // '125.164.110.136:8080',
  // '118.99.109.28:3128',
  // '180.245.239.252:8080',
  // '36.74.137.116:8080',
  // '118.97.188.34:8080',
  // '36.71.141.133:8080',
  // '36.82.225.61:8080',
  // '110.139.16.201:8080',
  // '36.75.46.35:80',
  // '118.99.127.114:3128',
  // '180.253.57.10:8080',
  // '146.196.108.202:80',
  // '103.111.53.75:8083',
  // '114.5.195.226:8080',
  // '182.253.171.174:80',
  // '202.162.195.77:3128',
  // '118.99.95.136:8080',
  // '182.253.114.66:8080',
  // '103.111.83.26:53861',
  // '36.90.122.206:8181',
  // '36.90.19.227:8181',
  // '103.89.3.242:80',
  // '103.36.35.135:8080',
  // '36.76.187.79:8080',
  // '36.66.57.213:80',
  // '36.74.193.178:3128',
  // '163.53.185.18:8080',
  // '66.96.237.253:8080',
  // '103.76.175.84:8080',
  // '116.197.133.27:8080',
  // '103.121.149.90:8080',
  // '115.124.86.107:37600',
  // '36.92.159.69:8080',
  // '36.85.135.76:8080',
  // '118.136.135.163:8080',
  // '182.253.168.187:8080',
  // '180.254.44.141:8080',
  // '119.252.160.165:3128',
  // '36.68.60.133:8080',
  // '36.76.82.21:3128',
  // '36.67.206.187:8080',
  // '115.85.86.235:8080',
  // '36.89.99.93:80',
  // '103.105.67.158:80',
  // '36.76.22.35:8080',
  // '103.49.221.27:8080',
  // '36.91.169.221:3128',
  // '124.158.167.170:8080',
  // '139.5.153.133:8080',
  // '36.77.27.253:8080',
  // '43.229.22.102:8080',
  // '202.169.252.133:8181',
  // '36.91.144.227:8080',
  // '180.211.92.42:808',
  // '36.90.49.73:8181',
  // '36.90.123.46:8181',
  // '103.11.107.67:53398',
  // '118.99.100.162:8080',
  // '125.164.32.10:8080',
  // '182.253.94.178:8080',
  // '103.234.254.10:3128',
  // '118.99.74.15:8080',
  // '112.78.169.98:36963',
  // '43.245.184.238:8080',
  // '180.244.90.55:3128',
  // '103.233.153.126:8888',
  // '36.72.148.104:8080',
  // '175.184.232.62:6667',
  // '114.5.128.18:50565',
  // '103.111.219.34:8118',
  // '122.50.5.146:10000',
  // '175.176.167.109:8080',
  // '27.54.118.235:8080',
  // '114.7.164.182:8080',
  // '103.107.71.48:8080',
  // '114.141.54.180:8080',
  // '36.74.47.4:80',
  // '202.152.27.75:8080',
  // '182.253.66.206:3128',
  // '36.79.158.247:8080',
  // '103.10.81.172:80',
  // '110.232.80.228:8080',
  // '118.99.94.163:8080',
  // '125.161.26.173:8080',
  // '182.253.115.90:8080',
  // '36.81.196.251:8080',
  // '139.255.48.164:8080',
  // '182.23.107.210:3128',
  // '202.93.113.9:55453',
  // '36.91.32.27:8080',
  // '36.75.206.179:3128',
  // '202.182.57.10:8080',
  // '182.253.115.66:57733',
  // '36.82.92.116:8080',
  // '103.70.79.2:8080',
  // '182.253.173.108:8080',
  // '110.232.83.115:8080',
  // '116.0.2.162:43927',
  // '180.253.58.5:8080',
  // '119.252.162.19:8080',
  // '202.150.143.59:43921',
  // '180.249.195.63:8080',
  // '118.97.36.18:8080',
  // '180.253.37.95:8080',
  // '36.77.247.228:8080',
  // '180.243.214.111:8080',
  // '36.37.112.210:42883',
  // '36.67.24.109:37641',
  // '36.89.151.27:59760',
  // '118.99.88.211:3128',
  // '158.140.169.104:8181',
  // '66.96.253.234:8080',
  // '103.28.149.107:3128',
  // '111.68.26.237:8080',
  // '116.197.129.26:80',
  // '36.68.81.45:8080',
  // '125.167.235.208:3128',
  // '182.253.171.174:8080',
  // '103.111.54.26:49781',
  // '36.89.93.28:8080',
  // '36.67.42.39:35273',
  // '182.253.201.70:3128',
  // '103.20.189.126:3128',
  // '112.78.39.198:57463',
  // '180.246.113.7:8080',
  // '36.90.251.104:8080',
  // '124.158.164.38:8080',
  // '202.162.198.93:8080',
  // '180.245.89.19:8080',
  // '103.86.155.78:58703',
  // '157.119.57.90:8080',
  // '36.89.106.247:43184',
  // '36.67.57.45:53367',
  // '202.150.139.46:59979',
  // '36.67.27.189:47877',
  // '36.90.171.182:8181',
  // '36.71.82.100:8080',
  // '210.210.156.69:8080',
  // '118.97.251.169:8080',
  // '36.91.28.210:8080',
  // '36.92.219.114:8080',
  // '202.154.180.53:52937',
  // '36.66.114.249:8080',
  // '36.78.222.198:8080',
  // '103.78.74.150:8080',
  // '114.4.105.48:8080',
  // '182.253.209.205:3128',
  // '36.92.106.169:8080',
  // '36.76.27.29:8080',
  // '36.92.88.53:8080',
  // '180.246.76.220:3128',
  // '180.246.89.208:8080',
  // '139.255.115.139:8080',
  // '36.81.1.38:8080',
  // '36.90.122.224:8181',
  // '36.65.39.59:8080',
  // '36.90.49.242:8080',
  // '202.162.211.46:30161',
  // '27.111.43.17:80',
  // '223.25.101.242:59504',
  // '202.147.198.115:8080',
  // '180.251.50.127:3128',
  // '36.37.81.135:8080',
  // '203.142.71.52:8080',
  // '110.232.80.229:8080',
  // '118.97.100.83:35220',
  // '220.247.174.235:40768',
  // '117.54.13.174:34190',
  // '36.66.124.157:8080',
  // '114.57.185.12:60115',
  // '202.158.49.140:56687',
  // '36.67.198.35:3128',
  // '202.93.225.26:3128',
  // '36.89.231.98:8080',
  // '180.250.255.179:80',
  // '182.253.204.66:34967',
  // '103.227.147.142:37581',
  // '118.99.94.172:8080',
  // '202.147.195.158:8080',
  // '61.247.10.26:8080',
  // '36.85.19.167:8080',
  // '36.90.13.34:8080',
  // '117.102.73.100:8080',
  // '124.158.175.2:8080',
  // '180.251.115.103:80',
  // '223.25.111.8:8181',
  // '36.88.146.207:8080',
  // '116.68.160.114:8080',
  ///
  // '202.43.183.210:80',
  // '36.83.183.246:8080',
  // '103.226.51.80:8080',
  // '61.247.59.107:8080',
  // '180.248.64.253:8080',
  // '139.228.246.45:8080',
  // '115.124.78.142:38994',
  // '139.255.25.106:80',
  // '114.141.49.22:3128',
  // '202.182.48.86:57942',
  // '203.190.53.45:53927',
  // '36.81.32.123:3128',
  // '103.78.101.101:8080',
  // '36.90.59.204:3128',
  // '103.83.99.69:3128',
  // '36.92.79.235:8080',
  // '36.66.175.111:51498',
  // '139.255.123.194:4550',
  // '139.255.141.65:8080',
  // '125.163.109.28:8080',
  // '210.211.18.62:8080',
  // '182.16.163.202:8080',
  // '36.90.164.254:3128',
  // '36.89.243.187:39796',
  // '103.140.206.171:8080',
  // '36.90.123.193:8181',
  // '103.28.57.122:8080',
  // '36.70.42.19:8080',
  // '117.102.77.2:8080',
  // '36.70.93.211:8080',
  // '118.99.124.251:8080',
  // '36.67.32.87:8080',
  // '202.150.151.85:3128',
  // '202.137.25.8:8080',
  // '119.252.162.19:80',
  // '125.167.90.228:8080',
  // '202.93.229.98:8080',
  '36.80.148.102:8080',
  '118.99.76.102:8080',
  '36.67.230.250:3128',
  '36.90.106.103:3128',
  '36.88.137.67:8080',
  '36.74.125.245:8080',
  '36.91.30.81:8080',
  '180.243.61.177:8080',
  '36.68.22.65:8080',
  '117.102.127.130:8080',
  '119.235.27.118:8080',
  '139.255.13.153:8080',
  '202.138.236.35:31173',
  '103.23.32.131:8080',
  '36.89.228.201:39628',
  '203.142.74.173:80',
  '180.250.197.91:8080',
  '36.82.17.92:8080',
  '36.89.234.175:8080',
  '103.246.2.166:8080',
  '124.158.170.238:3128',
  '36.89.192.119:34879',
  '103.122.66.172:8080',
  '36.89.169.170:8080',
  '182.253.31.149:8080',
  '36.81.239.219:8080',
  '36.67.85.218:58670',
  '110.232.67.20:8080',
  '36.92.18.179:8080',
  '139.194.34.243:8080',
  '36.90.62.34:8080',
  '36.89.65.253:36486',
  '202.162.222.118:46526',
  '125.163.226.135:8080',
  '202.138.248.85:8080',
  '202.147.207.253:38646',
  '182.253.175.58:8080',
  '114.141.54.220:8080',
  '121.101.134.234:8080',
  '210.210.129.83:59623',
  '36.91.88.166:8080',
  '36.78.24.179:3128',
  '36.89.145.162:80',
  '36.85.67.155:8080',
  '202.162.217.6:8080',
  '203.142.76.171:3128',
  '36.65.231.76:8080',
  '36.90.47.64:8888',
  '125.165.192.100:8080',
  '203.77.252.250:54598',
  '182.253.209.203:3128',
  '36.74.149.70:8080',
  '36.67.66.202:55638',
  '139.255.101.106:8080',
  '121.52.140.95:8080',
  '36.92.35.73:3128',
  '36.89.194.113:38622',
  '118.99.65.88:3128',
  '36.78.141.186:8181',
  '101.255.40.18:31558',
  '36.89.119.149:8080',
  '36.90.157.109:80',
  '203.142.69.242:31282',
  '36.67.80.19:8080',
  '111.95.23.240:3128',
  '103.215.177.180:80',
  '36.89.240.9:8080',
  '36.91.69.82:8080',
  '36.89.190.211:44277',
  '182.253.86.104:8080',
  '103.119.144.206:8080',
  '139.194.36.194:8080',
  '36.78.221.127:8080',
  '182.253.74.198:8080',
  '103.235.67.30:9090',
  '43.252.73.99:53557',
  '125.162.82.50:3128',
  '36.81.218.46:3128',
  '114.141.49.22:80',
  '43.225.67.181:8080',
  '139.0.134.190:8080',
  '36.92.125.37:8080',
  '182.23.81.82:3128',
  '36.66.170.19:8080',
  '36.91.128.66:8080',
  '202.138.253.235:8080',
  '36.92.10.95:3128',
  '183.81.157.225:8080',
  '202.152.55.67:80',
  '45.112.127.23:8080',
  '202.171.15.163:8080',
  '180.246.205.208:37224',
  '36.66.19.10:8080',
  '103.114.53.2:8080',
  '36.89.8.235:8080',
  '203.190.116.42:8080',
  '36.90.176.129:8080',
  '36.89.229.97:35098',
  '125.160.53.99:3128',
  '103.143.196.26:8080',
  '36.80.31.79:8080',
  '36.91.119.243:9999',
  '36.37.73.254:8080',
  '123.231.254.82:8080',
  '36.89.181.161:50204',
  '36.66.55.153:80',
  '36.76.22.153:8080',
  '202.75.97.82:47009',
  '36.80.248.174:8080',
  '182.253.130.3:3128',
  '203.128.79.18:43227',
  '182.253.91.49:8080',
  '180.247.34.29:8080',
  '117.102.119.150:47704',
  '101.255.122.73:8080',
  '36.91.194.25:8080',
  '103.141.180.130:8080',
  '36.92.85.90:8080',
  '117.102.94.148:34742',
  '36.90.4.220:8080',
  '36.90.155.177:8181',
  '36.66.218.121:35004',
  '36.74.134.38:8080',
  '36.74.211.216:8080',
  '103.141.180.62:80',
  '124.158.175.19:8080',
  '36.89.165.89:43139',
  '118.99.100.40:8080',
  '202.83.121.90:80',
  '180.178.97.90:8080',
  '36.91.193.154:3128',
  '36.91.45.10:50446',
  '182.253.80.194:8080',
  /////

  // // '125.161.143.155:8080',
  // // '180.246.110.216:8080',
  // // '202.93.228.150:39081',
  // // '125.160.169.19:8080',
  // // '180.246.221.153:8080',
  // // '36.37.113.4:36485',
  // // '36.90.20.89:3128',
  // // '36.66.140.15:8080',
  // // '36.75.209.8:80',
  // // '175.106.11.44:80',
  // // '118.97.99.50:8080',
  // // '118.96.242.148:3128',
  // // '36.91.100.149:80',
  // // '202.51.110.158:32247',
  // // '36.85.65.102:3128',
  // // '36.92.93.43:8080',
  // // '36.72.228.77:8080',
  // // '103.78.74.170:3128',
  // // '36.77.55.50:8080',
  // // '36.89.149.107:8080',
  // // '36.70.69.119:8080',
  // // '27.111.44.202:80',
  // // '36.89.247.59:43011',
  // // '137.59.161.46:8080',
  // // '110.5.102.238:8082',
  // // '103.42.253.210:38141',
  // // '103.31.45.174:8080',
  // // '125.162.31.101:3128',
  // // '103.111.83.122:3128',
  // // '103.241.204.225:8080',
  // // '36.90.245.242:8080',
  // '101.255.116.61:8080',
  // '119.18.152.210:3127',
  // '125.167.157.216:3128',
  // '203.173.94.238:8089',
  // '36.91.51.233:3128',
  // '115.85.83.197:8080',
  // '43.252.145.50:8080',
  // '122.248.45.35:53281',
  // '203.84.141.89:9999',
  // '180.178.94.20:8080',
  // '118.99.103.220:8080',
  // '36.91.44.243:37927',
  // '36.72.80.95:8080',
  // '36.89.193.169:49612',
  // '36.67.223.67:57877',
  // '118.97.164.19:8080',
  // '103.85.63.66:53281',
  // '103.94.7.254:53281',
  // '36.89.99.98:44030',
  // '118.97.151.130:9090',
  // '103.109.2.42:8080',
  // '103.75.27.86:8080',
  // '182.253.82.154:37242',
  // '203.142.68.141:3128',
  // '103.109.0.46:8080',
  // '103.10.81.172:8080',
  // '14.102.152.158:8080',
  // '112.78.187.186:51038',
  // '114.6.227.28:8080',
  // '117.102.105.91:8080',
  // '202.43.183.210:8080',
  // '182.23.54.146:48674',
  // '36.92.209.133:8080',
  // '103.78.213.226:45075',
  // '115.85.65.94:8080',
  // '202.93.229.102:8080',
  // '36.66.98.6:53281',
  // '124.158.175.29:8080',
  // '36.66.61.119:8080',
  // '139.228.48.104:8080',
  // '118.97.36.21:8080',
  // '27.123.7.82:8080',
  // '117.102.81.2:53281',
  // '36.67.89.179:65205',
  // '103.247.21.19:8080',
  // '182.253.223.138:8080',
  // '110.139.79.94:8080',
  // '114.129.18.234:3128',
  // '103.28.226.125:32862',
  // '103.105.71.170:8080',
  // '202.6.224.54:8080',
  // '36.78.6.191:8080',
  // '36.67.39.41:8080',
  // '36.81.255.22:8080',
  // '103.75.27.86:3128',
  // '103.3.46.213:8080',
  // '114.57.49.242:53281',
  // '203.142.69.66:8080',
  // '175.103.35.238:8080',
  // '118.97.197.229:3128',
  // '203.190.116.140:56163',
  // '117.102.78.42:8080',
  // '180.250.198.138:8080',
  // '103.78.73.34:80',
  // '36.89.193.109:47040',
  // '139.255.27.250:8080',
  // '175.106.17.62:30544',
  // '180.250.49.138:8080',
  // '110.5.100.130:56998',
  // '43.225.186.18:80',
  // '36.89.129.15:35270',
  // '36.65.170.44:8080',
  // '112.78.143.26:52443',
  // '110.138.199.74:8080',
  // '110.232.64.171:4777',
  // '112.78.163.160:8080',
  // '36.69.84.226:8080',
  // '202.55.169.141:3128',
  // '202.152.24.50:8080',
  // '202.43.115.145:8080',
  // '36.92.164.99:8080',
  // '101.255.63.10:43929',
  // '36.89.187.193:50689',
  // '114.129.17.52:9191',
  // '36.67.168.117:80',
  // '114.5.24.14:8080',
  // '36.74.194.96:8080',
  // '122.50.5.149:10000',
  // '180.242.221.14:8080',
  // '118.99.100.30:8080',
  // '36.74.67.118:3128',
  // '36.81.246.96:8080',
  // '36.67.47.187:40440',
  // '36.92.116.26:8080',
  // '36.92.58.244:8080',
  // '125.161.60.28:8080',
  // '36.80.126.114:8080',
  // '182.253.6.234:8080',
  // '36.81.42.113:8080',
  // '103.25.167.200:42375',
  // '180.252.238.146:8080',
  // '150.107.137.181:3128',
  // '203.77.229.124:8080',
  // '202.57.2.19:8080',
  // '36.92.93.107:8080',
];

(async function example() {  
  let views = 1;
  let success = 0;
  let currentIp = 0;

  let muteButton = null;

  async function view () {
    log(chalk.blue.bgBlueBright.bold(chalk.white(` Start get ${views} `)));
    if (currentIp === proxyServer.length) return;
    ping.promise.probe(proxyServer[currentIp].replace(/:.*/g, ''), {
      timeout: 1,
      extra: ["-i 2"],
    }).then(async function (res) {
      currentIp++;
      if (res.alive) {
        const driver = await new Builder()
          .forBrowser('firefox')
          .setFirefoxOptions(new firefox.Options().headless().windowSize(screen))
          .setProxy(proxy.manual({
            http: proxyServer[currentIp],
            https: proxyServer[currentIp]
          }))
          .build();
        try {
          // await driver.executeScript('window.open();');
          // await sleep.sleep(1);
          // const tabs = await driver.getAllWindowHandles();
          // await driver.switchTo().window(tabs[views]);
          // driver.setProxy(proxy.manual({
          //   http: proxyServer[currentIp],
          //   https: proxyServer[currentIp]
          // }))
          // views++;
          // view();
          await driver.get('https://www.youtube.com/watch?v=gRiLiJNbpiM');
          await driver.findElement(By.css('button.ytp-large-play-button.ytp-button')).click();
          await sleep.sleep(3);

          muteButton = driver.findElement(By.css('button.ytp-mute-button.ytp-button'));

          // await driver.get('http://www.google.com/ncr');
          // await driver.findElement(By.name('q')).sendKeys('webdriver', Key.RETURN);
          // until.titleIs('webdriver - Google Search');
          
        } catch (error) {
          log(chalk.blue.bgRed.bold(chalk.white(' Error Start ')));
          console.log(error)
          try {
            await driver.quit();
          } catch (error) {
            console.log('error quite')
          }
          log(chalk.blue.bgRed.bold(chalk.white(' Error End ')));
        } finally {
          views++;
          view();
          setTimeout(async () => {
            if (!muteButton) return;
            await muteButton.click();
          }, (1000 * 10));
          setTimeout(async () => {
            success++;
            try {
              await driver.quit();
            } catch (error) {
              console.log('error quite')
            }
            log(chalk.blue.bgGreen.bold(chalk.white(` Success get ${success} views`)));
          }, (1000 * (60 * 5)) + (1000 * 24));
          log(chalk.blue.bgBlueBright.bold(chalk.white(` Finish get ${views} `)));
          log(chalk.blue.bgGreenBright.bold(chalk.white(` Total get ${success} views`)));
        }
      }
    }).catch(e => {
      log(chalk.blue.bgRed.bold(chalk.white(' Failed ping ')));
    })
  }

  try {
    view();
  } catch (error) {
    console.log(error)
  }
})(); 

